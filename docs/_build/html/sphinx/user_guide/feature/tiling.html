<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Loop Tiling &mdash; RAJA 2022.03.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="WorkGroup" href="workgroup.html" />
    <link rel="prev" title="Local Array" href="local_array.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> RAJA
            <img src="../../../_static/RAJA_LOGO_CMYK_White_Background_large.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.03
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">RAJA User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">Getting Started With RAJA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using_raja.html">Using RAJA in Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config_options.html">Build Configuration Options</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../features.html">RAJA Features</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="loop_basic.html">Elements of Loop Execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="policies.html">Policies</a></li>
<li class="toctree-l3"><a class="reference internal" href="iteration_spaces.html">Indices, Segments, and IndexSets</a></li>
<li class="toctree-l3"><a class="reference internal" href="view.html">View and Layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="reduction.html">Reduction Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="atomic.html">Atomic Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="scan.html">Scan Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="sort.html">Sort Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="resource.html">Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="local_array.html">Local Array</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Loop Tiling</a></li>
<li class="toctree-l3"><a class="reference internal" href="workgroup.html">WorkGroup</a></li>
<li class="toctree-l3"><a class="reference internal" href="vectorization.html">Vectorization (SIMD/SIMT)</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugins.html">Plugins</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app_considerations.html">Application Considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial.html">RAJA Tutorial and Examples</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">RAJA Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../raja_license.html">RAJA Copyright and License Information</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">RAJA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">RAJA User Guide</a> &raquo;</li>
          <li><a href="../features.html">RAJA Features</a> &raquo;</li>
      <li>Loop Tiling</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/sphinx/user_guide/feature/tiling.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="loop-tiling">
<span id="feat-tiling-label"></span><h1>Loop Tiling<a class="headerlink" href="#loop-tiling" title="Permalink to this headline">¶</a></h1>
<p>In this section, we discuss RAJA statements that can be used to tile nested
loops. Typical loop tiling involves partitioning an iteration space into
a collection of “tiles” and then iterating over tiles in outer loops and
indices within each tile in inner loops. Many scientific computing algorithms
can benefit from loop tiling due to more efficient cache usage on a CPU or
use of GPU shared memory.</p>
<p>For example, consider an operation performed using a C-style for-loop with
a range of [0, 10):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">loop</span> <span class="n">body</span> <span class="n">using</span> <span class="n">index</span> <span class="s1">&#39;i&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This May be written as a loop nest that iterates over five tiles of size two:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">numTiles</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="nb">int</span> <span class="n">tileDim</span>  <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">t</span><span class="o">&lt;</span><span class="n">numTiles</span><span class="p">;</span> <span class="o">++</span><span class="n">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">tileDim</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">tileDim</span><span class="o">*</span><span class="n">t</span><span class="p">;</span> <span class="o">//</span> <span class="n">Calculate</span> <span class="k">global</span> <span class="n">index</span> <span class="s1">&#39;i&#39;</span>
    <span class="o">//</span> <span class="n">loop</span> <span class="n">body</span> <span class="n">using</span> <span class="n">index</span> <span class="s1">&#39;i&#39;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Next, we show how loop tiling can be written using RAJA with variations that
use different <code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code> execution policy statement types.</p>
<p>Here is a way to write the tiled loop kernel above using <code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">KERNEL_EXEC_POL</span> <span class="o">=</span>
  <span class="n">RAJA</span><span class="p">::</span><span class="n">KernelPolicy</span><span class="o">&lt;</span>
    <span class="n">RAJA</span><span class="p">::</span><span class="n">statement</span><span class="p">::</span><span class="n">Tile</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">RAJA</span><span class="p">::</span><span class="n">tile_fixed</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">RAJA</span><span class="p">::</span><span class="n">seq_exec</span><span class="p">,</span>
      <span class="n">RAJA</span><span class="p">::</span><span class="n">statement</span><span class="p">::</span><span class="n">For</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">RAJA</span><span class="p">::</span><span class="n">seq_exec</span><span class="p">,</span>
        <span class="n">RAJA</span><span class="p">::</span><span class="n">statement</span><span class="p">::</span><span class="n">Lambda</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span>
      <span class="o">&gt;</span>
    <span class="o">&gt;</span>
  <span class="o">&gt;</span><span class="p">;</span>

<span class="n">RAJA</span><span class="p">::</span><span class="n">kernel</span><span class="o">&lt;</span><span class="n">KERNEL_EXEC_POL</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="n">RAJA</span><span class="p">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">RAJA</span><span class="p">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span>
  <span class="p">[</span><span class="o">=</span><span class="p">]</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">kernel</span> <span class="n">body</span> <span class="n">using</span> <span class="n">index</span> <span class="s1">&#39;i&#39;</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>In RAJA, the simplest way to tile an iteration space is to use
<code class="docutils literal notranslate"><span class="pre">RAJA::statement::Tile</span></code> and <code class="docutils literal notranslate"><span class="pre">RAJA::statement::For</span></code> statement types. A
<code class="docutils literal notranslate"><span class="pre">RAJA::statement::Tile</span></code> type is similar to a <code class="docutils literal notranslate"><span class="pre">RAJA::statement::For</span></code> type,
but takes a tile size as the second template argument. The
<code class="docutils literal notranslate"><span class="pre">RAJA::statement::Tile</span></code> type generates the outer loop over tiles and
the <code class="docutils literal notranslate"><span class="pre">RAJA::statement::For</span></code> type iterates over each tile.  Nested together,
these statements will pass the global index (‘i’ in the example) to the
lambda expression as (kernel body) in a non-tiled version above.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using <code class="docutils literal notranslate"><span class="pre">RAJA::statement::Tile</span></code> and <code class="docutils literal notranslate"><span class="pre">RAJA::statement::For</span></code>
types together to define a tiled loop structure, the integer passed
as the first template argument to each statement type must be the
same. This indicates that they both apply to the same iteration space
in the space tuple passed to the <code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code> method.</p>
</div>
<p>RAJA also provides alternative statements that provide the tile number and
local tile index, if needed inside the kernel body, as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">KERNEL_EXEC_POL2</span> <span class="o">=</span>
  <span class="n">RAJA</span><span class="p">::</span><span class="n">KernelPolicy</span><span class="o">&lt;</span>
    <span class="n">RAJA</span><span class="p">::</span><span class="n">statement</span><span class="p">::</span><span class="n">TileTCount</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">RAJA</span><span class="p">::</span><span class="n">statement</span><span class="p">::</span><span class="n">Param</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span>
                                <span class="n">RAJA</span><span class="p">::</span><span class="n">tile_fixed</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">RAJA</span><span class="p">::</span><span class="n">seq_exec</span><span class="p">,</span>
      <span class="n">RAJA</span><span class="p">::</span><span class="n">statement</span><span class="p">::</span><span class="n">ForICount</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">RAJA</span><span class="p">::</span><span class="n">statement</span><span class="p">::</span><span class="n">Param</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span>
                                 <span class="n">RAJA</span><span class="p">::</span><span class="n">seq_exec</span><span class="p">,</span>
        <span class="n">RAJA</span><span class="p">::</span><span class="n">statement</span><span class="p">::</span><span class="n">Lambda</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span>
      <span class="o">&gt;</span>
    <span class="o">&gt;</span>
  <span class="o">&gt;</span><span class="p">;</span>


<span class="n">RAJA</span><span class="p">::</span><span class="n">kernel_param</span><span class="o">&lt;</span><span class="n">KERNEL_EXEC_POL2</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="n">RAJA</span><span class="p">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">RAJA</span><span class="p">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span>
  <span class="n">RAJA</span><span class="p">::</span><span class="n">make_tuple</span><span class="p">((</span><span class="nb">int</span><span class="p">)</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="mi">0</span><span class="p">),</span>
  <span class="p">[</span><span class="o">=</span><span class="p">](</span><span class="nb">int</span> <span class="n">i</span><span class="p">,</span> <span class="nb">int</span> <span class="n">t</span><span class="p">,</span> <span class="nb">int</span> <span class="n">j</span><span class="p">)</span> <span class="p">{</span>

    <span class="o">//</span> <span class="n">i</span> <span class="o">-</span> <span class="k">global</span> <span class="n">index</span>
    <span class="o">//</span> <span class="n">t</span> <span class="o">-</span> <span class="n">tile</span> <span class="n">number</span>
    <span class="o">//</span> <span class="n">j</span> <span class="o">-</span> <span class="n">index</span> <span class="n">within</span> <span class="n">tile</span>
    <span class="o">//</span> <span class="n">Then</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">t</span> <span class="p">(</span><span class="mi">2</span> <span class="ow">is</span> <span class="n">tile</span> <span class="n">size</span><span class="p">)</span>

  <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">RAJA::statement::TileTCount</span></code> type indicates that the tile number will
be passed to the lambda expression and the <code class="docutils literal notranslate"><span class="pre">RAJA::statement::ForICount</span></code> type
indicates that the local tile loop index will be passed to the lambda
expression. Storage for these values is specified in the parameter tuple, the
second argument passed to the <code class="docutils literal notranslate"><span class="pre">RAJA::kernel_param</span></code> method. The
<code class="docutils literal notranslate"><span class="pre">RAJA::statement::Param&lt;#&gt;</span></code> type appearing as the second
template parameter for each statement type indicates which parameter tuple
entry, the tile number or local tile loop index, is passed to the lambda and
in which order. Here, the tile number is the second lambda argument (tuple
parameter ‘0’) and the local tile loop index is the third lambda argument
(tuple parameter ‘1’).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The global loop indices always appear as the first lambda expression
arguments. Then, the parameter tuples identified by the integers
in the <code class="docutils literal notranslate"><span class="pre">RAJA::Param</span></code> statement types given for the loop statement
types follow.</p>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="local_array.html" class="btn btn-neutral float-left" title="Local Array" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="workgroup.html" class="btn btn-neutral float-right" title="WorkGroup" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, Lawrence Livermore National Security, LLNS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>