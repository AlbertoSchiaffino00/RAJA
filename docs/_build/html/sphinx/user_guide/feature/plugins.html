<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plugins &mdash; RAJA 2022.03.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Application Considerations" href="../app_considerations.html" />
    <link rel="prev" title="Vectorization (SIMD/SIMT)" href="vectorization.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> RAJA
            <img src="../../../_static/RAJA_LOGO_CMYK_White_Background_large.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.03
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">RAJA User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">Getting Started With RAJA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using_raja.html">Using RAJA in Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config_options.html">Build Configuration Options</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../features.html">RAJA Features</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="loop_basic.html">Elements of Loop Execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="policies.html">Policies</a></li>
<li class="toctree-l3"><a class="reference internal" href="iteration_spaces.html">Indices, Segments, and IndexSets</a></li>
<li class="toctree-l3"><a class="reference internal" href="view.html">View and Layout</a></li>
<li class="toctree-l3"><a class="reference internal" href="reduction.html">Reduction Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="atomic.html">Atomic Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="scan.html">Scan Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="sort.html">Sort Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="resource.html">Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="local_array.html">Local Array</a></li>
<li class="toctree-l3"><a class="reference internal" href="tiling.html">Loop Tiling</a></li>
<li class="toctree-l3"><a class="reference internal" href="workgroup.html">WorkGroup</a></li>
<li class="toctree-l3"><a class="reference internal" href="vectorization.html">Vectorization (SIMD/SIMT)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Plugins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-raja-plugins">Using RAJA Plugins</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-plugins-for-raja">Creating Plugins For RAJA</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app_considerations.html">Application Considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial.html">RAJA Tutorial and Examples</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">RAJA Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../raja_license.html">RAJA Copyright and License Information</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">RAJA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">RAJA User Guide</a> &raquo;</li>
          <li><a href="../features.html">RAJA Features</a> &raquo;</li>
      <li>Plugins</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/sphinx/user_guide/feature/plugins.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="plugins">
<span id="feat-plugins-label"></span><h1>Plugins<a class="headerlink" href="#plugins" title="Permalink to this headline">¶</a></h1>
<p>RAJA supports user-made plugins that may be loaded either at compilation time
(static plugins) or during runtime (dynamic plugins). These two methods are not
mutually exclusive, as plugins loaded statically can be run alongside plugins that
are loaded dynamically.</p>
<section id="using-raja-plugins">
<h2>Using RAJA Plugins<a class="headerlink" href="#using-raja-plugins" title="Permalink to this headline">¶</a></h2>
<section id="static-vs-dynamic-loading">
<h3>Static vs Dynamic Loading<a class="headerlink" href="#static-vs-dynamic-loading" title="Permalink to this headline">¶</a></h3>
<p><strong>Static loading</strong> is done at compile time and requires recompilation in order to add, remove, or change a plugin. This is arguably the easier method to implement, requiring only simple file linking to make work. However, recompilation may get tedious and resource-heavy when working with many plugins or on large projects. In these cases, it may be better to load plugins dynamically, requiring no recompilation of the project most of the time.</p>
<p><strong>Dynamic loading</strong> is done at runtime and only requires the recompilation or
moving of plugin files in order to add, remove, or change a plugin. This will
likely require more work to set up, but in the long run may save time and resources.
RAJA checks the environment variable <code class="docutils literal notranslate"><span class="pre">RAJA_PLUGINS</span></code> for a path to a plugin or
plugin directory, and automatically loads them at runtime. This means that a plugin
can be added to a project as easily as making a shared object file and setting
<code class="docutils literal notranslate"><span class="pre">RAJA_PLUGINS</span></code> to the appropriate path.</p>
</section>
<section id="plugins-quick-start">
<h3>Plugins Quick Start<a class="headerlink" href="#plugins-quick-start" title="Permalink to this headline">¶</a></h3>
<p><strong>Static Plugins</strong></p>
<ol class="arabic simple">
<li><p>Build RAJA normally.</p></li>
<li><p>Use an <code class="docutils literal notranslate"><span class="pre">#include</span></code> statement in your code or pass options to the compiler to load your plugin file with your project at compile time. For example: <code class="docutils literal notranslate"><span class="pre">g++</span> <span class="pre">project.cpp</span> <span class="pre">plugin.cpp</span> <span class="pre">-lRAJA</span> <span class="pre">-ldl</span> <span class="pre">-o</span> <span class="pre">project</span></code>.</p></li>
<li><p>When you run your project, your plugin should work.</p></li>
</ol>
<p><strong>Dynamic Plugins</strong></p>
<ol class="arabic simple">
<li><p>Build RAJA normally.</p></li>
<li><p>Compile your plugin to be a shared object file with <code class="docutils literal notranslate"><span class="pre">.so</span></code> extension. For example: <code class="docutils literal notranslate"><span class="pre">g++</span> <span class="pre">plugin.cpp</span> <span class="pre">-lRAJA</span> <span class="pre">-fPIC</span> <span class="pre">-shared</span> <span class="pre">-o</span> <span class="pre">plugin.so</span></code>.</p></li>
<li><p>Set the environment variable <code class="docutils literal notranslate"><span class="pre">RAJA_PLUGINS</span></code> to the path of your <code class="docutils literal notranslate"><span class="pre">.so</span></code> file.  This can either be the path to its directory or to the shared object file itself. If the path is a directory, all <code class="docutils literal notranslate"><span class="pre">.so</span></code> files in that directory will be loaded.</p></li>
<li><p>When you run your project, your plugins should work.</p></li>
</ol>
</section>
<section id="interfacing-with-plugins">
<h3>Interfacing with Plugins<a class="headerlink" href="#interfacing-with-plugins" title="Permalink to this headline">¶</a></h3>
<p>The RAJA plugin API allows for limited interfacing between a project and a
plugin. There are a couple of methods to call in your code:
<code class="docutils literal notranslate"><span class="pre">init_plugins</span></code> and <code class="docutils literal notranslate"><span class="pre">finalize_plugins</span></code>. These will call the corresponding
<code class="docutils literal notranslate"><span class="pre">init</span></code> and <code class="docutils literal notranslate"><span class="pre">finalize</span></code> methods, respectively, of <em>every</em> currently loaded
plugin. It’s worth noting that plugins don’t require either an init or finalize
method by default.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RAJA::util::init_plugins();</span></code> will call the <code class="docutils literal notranslate"><span class="pre">init</span></code> method of every
currently loaded plugin.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RAJA::util::init_plugins(&quot;path/to/plugins&quot;);</span></code> will call the <code class="docutils literal notranslate"><span class="pre">init</span></code>
method of every currently loaded plugin and, in addition, will also
dynamically load plugins located at the given path.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RAJA::util::finalize_plugins();</span></code> will call the <code class="docutils literal notranslate"><span class="pre">finalize</span></code> method of
every currently loaded plugin.</p></li>
</ul>
</section>
</section>
<section id="creating-plugins-for-raja">
<h2>Creating Plugins For RAJA<a class="headerlink" href="#creating-plugins-for-raja" title="Permalink to this headline">¶</a></h2>
<p>Plugins are classes derived from the <code class="docutils literal notranslate"><span class="pre">RAJA::util::PluginStrategy</span></code> base class
and implement the required virtual methods for the API. An example
implementation can be found at the bottom of this page.</p>
<section id="plugin-api-methods">
<h3>Plugin API methods<a class="headerlink" href="#plugin-api-methods" title="Permalink to this headline">¶</a></h3>
<p>The following list summarizes the virtual methods in the
<code class="docutils literal notranslate"><span class="pre">RAJA::util::PluginStrategy</span></code> base class.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">init(const</span> <span class="pre">PluginOptions&amp;</span> <span class="pre">p)</span> <span class="pre">override</span> <span class="pre">{}</span></code> is called on all plugins
when a user calls <code class="docutils literal notranslate"><span class="pre">init_plugins()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">preCapture(const</span> <span class="pre">PluginContext&amp;</span> <span class="pre">p)</span> <span class="pre">override</span> <span class="pre">{}</span></code> is called before
lambda capture in RAJA kernel execution methods.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">postCapture(const</span> <span class="pre">PluginContext&amp;</span> <span class="pre">p)</span> <span class="pre">override</span> <span class="pre">{}</span></code> is called after
lambda capture in RAJA kernel execution methods.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">preLaunch(const</span> <span class="pre">PluginContext&amp;</span> <span class="pre">p)</span> <span class="pre">override</span> <span class="pre">{}</span></code> is called before
a RAJA kernel execution method runs a kernel.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">postLaunch(const</span> <span class="pre">PluginContext&amp;</span> <span class="pre">p)</span> <span class="pre">override</span> <span class="pre">{}</span></code> is called after
a RAJA kernel execution method runs a kernel.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">finalize()</span> <span class="pre">override</span> <span class="pre">{}</span></code> is called on all plugins when a user calls
<code class="docutils literal notranslate"><span class="pre">finalize_plugins</span></code>. This will also unload all currently loaded plugins.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The pre/post methods above are automatically called
before and after executing a kernel with <code class="docutils literal notranslate"><span class="pre">RAJA::forall</span></code> or
<code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code> kernel execution methods.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">init</span></code> and <code class="docutils literal notranslate"><span class="pre">finalize</span></code> methods are never called by
default and are only called when a user calls
<code class="docutils literal notranslate"><span class="pre">RAJA::util::init_plugins()</span></code> or <code class="docutils literal notranslate"><span class="pre">RAJA::util::finalize_plugin()</span></code>,
respectively.</p>
</div>
</section>
<section id="static-loading">
<h3>Static Loading<a class="headerlink" href="#static-loading" title="Permalink to this headline">¶</a></h3>
<p>If a plugin is to be loaded into a project at compile time, it must be
loaded with either an <code class="docutils literal notranslate"><span class="pre">#include</span></code> statement in the project source code or
by calling the following method in the project source code, which adds the
plugin to the RAJA <a href="#id1"><span class="problematic" id="id2">``</span></a>PluginRegistry`::`</p>
<blockquote>
<div><p>static RAJA::util::PluginRegistry::add&lt;PluginName&gt; P(“Name”, “Description”);</p>
</div></blockquote>
<p>In either case, the plugin will be loaded every time the compiled
project executable is run.</p>
</section>
<section id="dynamic-loading">
<h3>Dynamic Loading<a class="headerlink" href="#dynamic-loading" title="Permalink to this headline">¶</a></h3>
<p>If a plugin is to be dynamically loaded in a project at run time, the RAJA
plugin API requires a few conditions to be met. The following must be true
about the plugin, not necessarily of the project using it.</p>
<ol class="arabic">
<li><p>The plugin must have the following factory method that returns
a pointer to an instance of your plugin:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extern</span> <span class="s2">&quot;C&quot;</span> <span class="n">RAJA</span><span class="p">::</span><span class="n">util</span><span class="p">::</span><span class="n">PluginStrategy</span><span class="o">*</span> <span class="n">getPlugin</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">new</span> <span class="n">MyPluginName</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that using <code class="docutils literal notranslate"><span class="pre">extern</span> <span class="pre">&quot;C&quot;</span></code> is required to search for the <code class="docutils literal notranslate"><span class="pre">getPlugin()</span></code>
method call for the dynamically loaded plugin correctly.</p>
</li>
<li><p>The plugin must be compiled to be a shared object with a <code class="docutils literal notranslate"><span class="pre">.so</span></code> extension.
For example: <code class="docutils literal notranslate"><span class="pre">g++</span> <span class="pre">plugin.cpp</span> <span class="pre">-lRAJA</span> <span class="pre">-fPIC</span> <span class="pre">-shared</span> <span class="pre">-o</span> <span class="pre">plugin.so</span></code>.</p>
<p>At the moment, RAJA will only attempt to load files with <code class="docutils literal notranslate"><span class="pre">.so</span></code> extensions.
It’s worth noting why these flags (or their equivalents) are important.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-lRAJA</span></code> is a standard flag for linking the RAJA library.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-fPIC</span></code> tells the compiler to produce <em>position independent code</em>,
which prevents conflicts in the address space of the executable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-shared</span></code> will let the compiler know that you want the resulting
object file to be shared, removing the need for a <em>main</em> as well as
giving dynamically loaded executables access to methods flagged
with <code class="docutils literal notranslate"><span class="pre">extern</span> <span class="pre">&quot;C&quot;</span></code>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">RAJA_PLUGINS</span></code> environment variable must be set, or the project code
must call <code class="docutils literal notranslate"><span class="pre">RAJA::util::init_plugins(&quot;path&quot;);</span></code>. Either of these approaches
is required to supply the path to either a directory containing the plugin
or its <code class="docutils literal notranslate"><span class="pre">.so</span></code> file. It’s worth noting that these are not mutually
exclusive. RAJA will look for plugins based on the environment variable on
program startup and new plugins may be loaded after that by calling the
<code class="docutils literal notranslate"><span class="pre">init_plugins()</span></code> method.</p></li>
</ol>
</section>
<section id="example-plugin-implementation">
<h3>Example Plugin Implementation<a class="headerlink" href="#example-plugin-implementation" title="Permalink to this headline">¶</a></h3>
<p>The following is an example plugin that simply will print out the number of
times a kernel has been launched and has the ability to be loaded either
statically or dynamically.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;RAJA/util/PluginStrategy.hpp&quot;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">class</span><span class="w"> </span><span class="nc">CounterPlugin</span><span class="w"> </span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">PluginStrategy</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">preCapture</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">PluginContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">platform</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">Platform</span><span class="o">::</span><span class="n">host</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; [CounterPlugin]: Capturing host kernel for the &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">++</span><span class="n">host_capture_counter</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; time!&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; [CounterPlugin]: Capturing device kernel for the &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">++</span><span class="n">device_capture_counter</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; time!&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">preLaunch</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">PluginContext</span><span class="o">&amp;</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">platform</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">Platform</span><span class="o">::</span><span class="n">host</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; [CounterPlugin]: Launching host kernel for the &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">++</span><span class="n">host_launch_counter</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; time!&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; [CounterPlugin]: Launching device kernel for the &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">++</span><span class="n">device_launch_counter</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; time!&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">host_capture_counter</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">device_capture_counter</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">host_launch_counter</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">device_launch_counter</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="c1">// Statically loading plugin.</span>
<span class="k">static</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">PluginRegistry</span><span class="o">::</span><span class="n">add</span><span class="o">&lt;</span><span class="n">CounterPlugin</span><span class="o">&gt;</span><span class="w"> </span><span class="n">P</span><span class="p">(</span><span class="s">&quot;Counter&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Counts number of kernel launches.&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">// Dynamically loading plugin.</span>
<span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">PluginStrategy</span><span class="w"> </span><span class="o">*</span><span class="n">getPlugin</span><span class="w"> </span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CounterPlugin</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="chai-plugin">
<h3>CHAI Plugin<a class="headerlink" href="#chai-plugin" title="Permalink to this headline">¶</a></h3>
<p>RAJA provides abstractions for parallel execution, but does not support
a memory model for managing data in heterogeneous memory spaces. One
option for managing such data is to use <a class="reference external" href="https://github.com/LLNL/CHAI">CHAI</a>,
which provides an array abstraction that integrates with RAJA to enable
automatic copying of data at runtime to the proper execution memory space for
a RAJA-based kernel determined by the RAJA execution policy used to execute the
kernel. Then, the data can be accessed inside the kernel as needed.</p>
<p>To build CHAI with RAJA integration, you need to download and install CHAI with
the <code class="docutils literal notranslate"><span class="pre">ENABLE_RAJA_PLUGIN</span></code> option turned on.  Please see
<a class="reference external" href="https://github.com/LLNL/CHAI">CHAI</a> for details.</p>
<p>After CHAI has been built with RAJA support enabled, applications can use CHAI
<code class="docutils literal notranslate"><span class="pre">ManangedArray</span></code> objects to access data inside a RAJA kernel. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chai</span><span class="p">::</span><span class="n">ManagedArray</span><span class="o">&lt;</span><span class="nb">float</span><span class="o">&gt;</span> <span class="n">array</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>

<span class="n">RAJA</span><span class="p">::</span><span class="n">forall</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="p">::</span><span class="n">cuda_exec</span><span class="o">&lt;</span><span class="mi">16</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="p">[</span><span class="o">=</span><span class="p">]</span> <span class="n">__device__</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mf">2.0</span><span class="n">f</span><span class="p">;</span>
<span class="p">});</span>

<span class="n">RAJA</span><span class="p">::</span><span class="n">forall</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="p">::</span><span class="n">loop_exec</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="p">[</span><span class="o">=</span><span class="p">]</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;array[&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;]  is &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="p">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Here, the data held by <code class="docutils literal notranslate"><span class="pre">array</span></code> is allocated on the host CPU. Then, it is
initialized on a CUDA GPU device. CHAI sees that the data lives on the CPU
and is needed in a GPU device data environment since it is used in a kernel that
will run with a RAJA CUDA execution policy. So it copies the data from
CPU memory to GPU memory, making it available for access in the RAJA kernel.
The data is printed in the second kernel which runs on the CPU (indicated by the
RAJA sequential execution policy). So CHAI copies the data back to the host CPU.
All necessary data copies are done transparently on demand for each kernel.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="vectorization.html" class="btn btn-neutral float-left" title="Vectorization (SIMD/SIMT)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../app_considerations.html" class="btn btn-neutral float-right" title="Application Considerations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, Lawrence Livermore National Security, LLNS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>