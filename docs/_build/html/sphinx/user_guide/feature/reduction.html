<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reduction Operations &mdash; RAJA 2022.03.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Atomic Operations" href="atomic.html" />
    <link rel="prev" title="View and Layout" href="view.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> RAJA
            <img src="../../../_static/RAJA_LOGO_CMYK_White_Background_large.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.03
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">RAJA User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">Getting Started With RAJA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using_raja.html">Using RAJA in Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config_options.html">Build Configuration Options</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../features.html">RAJA Features</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="loop_basic.html">Elements of Loop Execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="policies.html">Policies</a></li>
<li class="toctree-l3"><a class="reference internal" href="iteration_spaces.html">Indices, Segments, and IndexSets</a></li>
<li class="toctree-l3"><a class="reference internal" href="view.html">View and Layout</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Reduction Operations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#reduction-types">Reduction Types</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reduction-examples">Reduction Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reduction-policies">Reduction Policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#experimental-reduction-interface">Experimental Reduction Interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="atomic.html">Atomic Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="scan.html">Scan Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="sort.html">Sort Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="resource.html">Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="local_array.html">Local Array</a></li>
<li class="toctree-l3"><a class="reference internal" href="tiling.html">Loop Tiling</a></li>
<li class="toctree-l3"><a class="reference internal" href="workgroup.html">WorkGroup</a></li>
<li class="toctree-l3"><a class="reference internal" href="vectorization.html">Vectorization (SIMD/SIMT)</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugins.html">Plugins</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../app_considerations.html">Application Considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial.html">RAJA Tutorial and Examples</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">RAJA Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../raja_license.html">RAJA Copyright and License Information</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">RAJA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">RAJA User Guide</a> &raquo;</li>
          <li><a href="../features.html">RAJA Features</a> &raquo;</li>
      <li>Reduction Operations</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/sphinx/user_guide/feature/reduction.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="reduction-operations">
<span id="feat-reductions-label"></span><h1>Reduction Operations<a class="headerlink" href="#reduction-operations" title="Permalink to this headline">¶</a></h1>
<p>RAJA does not provide separate loop execution methods for loops containing
reduction operations like some other C++ loop programming abstraction models.
Instead, RAJA provides reduction types that allow users to perform reduction
operations in kernels launched using <code class="docutils literal notranslate"><span class="pre">RAJA::forall</span></code>, <code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code>,
and <code class="docutils literal notranslate"><span class="pre">RAJA::launch</span></code> methods in a portable, thread-safe manner. Users may
use as many reduction objects in a loop kernel as they need. Available RAJA
reduction types are described in this section.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All RAJA reduction types are located in the namespace <code class="docutils literal notranslate"><span class="pre">RAJA</span></code>.</p>
</div>
<p>Also</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Each RAJA reduction type is templated on a <strong>reduction policy</strong>
and a <strong>reduction value type</strong> for the reduction variable. The
<strong>reduction policy type must be compatible with the execution
policy used by the kernel in which it is used.</strong> For example, in
a CUDA kernel, a CUDA reduction policy must be used.</p></li>
<li><p>Each RAJA reduction type accepts an <strong>initial reduction value or
values</strong> at construction (see below).</p></li>
<li><p>Each RAJA reduction type has a ‘get’ method to access reduced
values after kernel execution completes.</p></li>
</ul>
</div>
<p>Please see the following tutorial sections for detailed examples that use
RAJA reductions:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="../tutorial/reductions.html#tut-reduction-label"><span class="std std-ref">Reduction Types and Kernels with Multiple Reductions</span></a>.</p></li>
</ul>
</div></blockquote>
<section id="reduction-types">
<h2>Reduction Types<a class="headerlink" href="#reduction-types" title="Permalink to this headline">¶</a></h2>
<p>RAJA supports five common reduction types:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ReduceSum&lt;</span> <span class="pre">reduce_policy,</span> <span class="pre">data_type</span> <span class="pre">&gt;</span></code> - Sum of values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ReduceMin&lt;</span> <span class="pre">reduce_policy,</span> <span class="pre">data_type</span> <span class="pre">&gt;</span></code> - Min value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ReduceMax&lt;</span> <span class="pre">reduce_policy,</span> <span class="pre">data_type</span> <span class="pre">&gt;</span></code> - Max value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ReduceMinLoc&lt;</span> <span class="pre">reduce_policy,</span> <span class="pre">data_type</span> <span class="pre">&gt;</span></code> - Min value and a loop index where the minimum was found.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ReduceMaxLoc&lt;</span> <span class="pre">reduce_policy,</span> <span class="pre">data_type</span> <span class="pre">&gt;</span></code> - Max value and a loop index where the maximum was found.</p></li>
</ul>
<p>and two less common bitwise reduction types:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ReduceBitAnd&lt;</span> <span class="pre">reduce_policy,</span> <span class="pre">data_type</span> <span class="pre">&gt;</span></code> - Bitwise ‘and’ of values (i.e., <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&amp;</span> <span class="pre">b</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ReduceBitOr&lt;</span> <span class="pre">reduce_policy,</span> <span class="pre">data_type</span> <span class="pre">&gt;</span></code> - Bitwise ‘or’ of values (i.e., <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">|</span> <span class="pre">b</span></code>).</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>When <code class="docutils literal notranslate"><span class="pre">RAJA::ReduceMinLoc</span></code> and <code class="docutils literal notranslate"><span class="pre">RAJA::ReduceMaxLoc</span></code> are used
in a sequential execution context, the loop index of the
min/max is the first index where the min/max occurs.</p></li>
<li><p>When these reductions are used in a parallel execution context,
the loop index computed for the reduction value may be any index
where the min or max occurs.</p></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">RAJA::ReduceBitAnd</span></code> and <code class="docutils literal notranslate"><span class="pre">RAJA::ReduceBitOr</span></code> reduction types are designed to work on integral data types because <strong>in C++, at the language level, there is no such thing as a bitwise operator on floating-point numbers.</strong></p>
</div>
</section>
<section id="reduction-examples">
<h2>Reduction Examples<a class="headerlink" href="#reduction-examples" title="Permalink to this headline">¶</a></h2>
<p>Next, we provide a few examples to illustrate basic usage of RAJA reduction
types.</p>
<p>Here is a simple RAJA reduction example that shows how to use a sum reduction
type and a min-loc reduction type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">const</span> <span class="nb">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>

<span class="o">//</span>
<span class="o">//</span> <span class="n">Initialize</span> <span class="n">array</span> <span class="n">of</span> <span class="n">length</span> <span class="n">N</span> <span class="k">with</span> <span class="nb">all</span> <span class="n">ones</span><span class="o">.</span> <span class="n">Then</span><span class="p">,</span> <span class="nb">set</span> <span class="n">some</span> <span class="n">other</span>
<span class="o">//</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">array</span> <span class="n">to</span> <span class="n">make</span> <span class="n">the</span> <span class="n">example</span> <span class="n">mildly</span> <span class="n">interesting</span><span class="o">...</span>
<span class="o">//</span>
<span class="nb">int</span> <span class="n">vec</span><span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">};</span>
<span class="n">vec</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="p">;</span> <span class="n">vec</span><span class="p">[</span><span class="mi">500</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Create</span> <span class="n">a</span> <span class="nb">sum</span> <span class="n">reduction</span> <span class="nb">object</span> <span class="k">with</span> <span class="n">initial</span> <span class="n">value</span> <span class="n">of</span> <span class="n">zero</span>
<span class="n">RAJA</span><span class="p">::</span><span class="n">ReduceSum</span><span class="o">&lt;</span> <span class="n">RAJA</span><span class="p">::</span><span class="n">omp_reduce</span><span class="p">,</span> <span class="nb">int</span> <span class="o">&gt;</span> <span class="n">vsum</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Create</span> <span class="n">a</span> <span class="nb">min</span><span class="o">-</span><span class="n">loc</span> <span class="n">reduction</span> <span class="nb">object</span> <span class="k">with</span> <span class="n">initial</span> <span class="nb">min</span> <span class="n">value</span> <span class="n">of</span> <span class="mi">100</span>
<span class="o">//</span> <span class="ow">and</span> <span class="n">initial</span> <span class="n">location</span> <span class="n">index</span> <span class="n">value</span> <span class="n">of</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">RAJA</span><span class="p">::</span><span class="n">ReduceMinLoc</span><span class="o">&lt;</span> <span class="n">RAJA</span><span class="p">::</span><span class="n">omp_reduce</span><span class="p">,</span> <span class="nb">int</span> <span class="o">&gt;</span> <span class="n">vminloc</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Run</span> <span class="n">a</span> <span class="n">kernel</span> <span class="n">using</span> <span class="n">the</span> <span class="n">reduction</span> <span class="n">objects</span>
<span class="n">RAJA</span><span class="p">::</span><span class="n">forall</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="p">::</span><span class="n">omp_parallel_for_exec</span><span class="o">&gt;</span><span class="p">(</span> <span class="n">RAJA</span><span class="p">::</span><span class="n">RangeSegment</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span>
  <span class="p">[</span><span class="o">=</span><span class="p">](</span><span class="n">RAJA</span><span class="p">::</span><span class="n">Index_type</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">vsum</span> <span class="o">+=</span> <span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
  <span class="n">vminloc</span><span class="o">.</span><span class="n">minloc</span><span class="p">(</span> <span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span> <span class="p">);</span>

<span class="p">});</span>

<span class="o">//</span> <span class="n">After</span> <span class="n">kernel</span> <span class="ow">is</span> <span class="n">run</span><span class="p">,</span> <span class="n">extract</span> <span class="n">the</span> <span class="n">reduced</span> <span class="n">values</span>
<span class="nb">int</span> <span class="n">my_vsum</span> <span class="o">=</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">vsum</span><span class="o">.</span><span class="n">get</span><span class="p">());</span>

<span class="nb">int</span> <span class="n">my_vmin</span> <span class="o">=</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">vminloc</span><span class="o">.</span><span class="n">get</span><span class="p">());</span>
<span class="nb">int</span> <span class="n">my_vminloc</span> <span class="o">=</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">vminloc</span><span class="o">.</span><span class="n">getLoc</span><span class="p">());</span>
</pre></div>
</div>
<p>The results of these operations will yield the following values:</p>
<blockquote>
<div><ul class="simple">
<li><p>my_vsum == 978 (= 998 - 10 - 10)</p></li>
<li><p>my_vmin == -10</p></li>
<li><p>my_vminloc == 100 or 500</p></li>
</ul>
</div></blockquote>
<p>Note that the location index for the minimum array value can be one of two
values depending on the order of the reduction finalization since the loop
is run in parallel. Also, note that the reduction objects are created using
a <code class="docutils literal notranslate"><span class="pre">RAJA::omp_reduce</span></code> reduction policy, which is compatible with the
OpenMP execution policy used in the kernel.</p>
<p>Here is an example of a bitwise or reduction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">const</span> <span class="nb">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>

<span class="o">//</span>
<span class="o">//</span> <span class="n">Initialize</span> <span class="nb">all</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">array</span> <span class="n">of</span> <span class="n">length</span> <span class="n">N</span> <span class="n">to</span> <span class="n">the</span> <span class="n">value</span> <span class="s1">&#39;9&#39;</span>
<span class="o">//</span>
<span class="nb">int</span> <span class="n">vec</span><span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">9</span><span class="p">};</span>

<span class="o">//</span> <span class="n">Create</span> <span class="n">a</span> <span class="n">bitwise</span> <span class="ow">or</span> <span class="n">reduction</span> <span class="nb">object</span> <span class="k">with</span> <span class="n">initial</span> <span class="n">value</span> <span class="n">of</span> <span class="s1">&#39;5&#39;</span>
<span class="n">RAJA</span><span class="p">::</span><span class="n">ReduceBitOr</span><span class="o">&lt;</span> <span class="n">RAJA</span><span class="p">::</span><span class="n">omp_reduce</span><span class="p">,</span> <span class="nb">int</span> <span class="o">&gt;</span> <span class="n">my_or</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Run</span> <span class="n">a</span> <span class="n">kernel</span> <span class="n">using</span> <span class="n">the</span> <span class="n">reduction</span> <span class="nb">object</span>
<span class="n">RAJA</span><span class="p">::</span><span class="n">forall</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="p">::</span><span class="n">omp_parallel_for_exec</span><span class="o">&gt;</span><span class="p">(</span> <span class="n">RAJA</span><span class="p">::</span><span class="n">RangeSegment</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span>
  <span class="p">[</span><span class="o">=</span><span class="p">](</span><span class="n">RAJA</span><span class="p">::</span><span class="n">Index_type</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">my_or</span> <span class="o">|=</span> <span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

<span class="p">});</span>

<span class="o">//</span> <span class="n">After</span> <span class="n">kernel</span> <span class="ow">is</span> <span class="n">run</span><span class="p">,</span> <span class="n">extract</span> <span class="n">the</span> <span class="n">reduced</span> <span class="n">value</span>
<span class="nb">int</span> <span class="n">my_or_reduce_val</span> <span class="o">=</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">my_or</span><span class="o">.</span><span class="n">get</span><span class="p">());</span>
</pre></div>
</div>
<p>The result of the reduction is the value ‘13’. In binary representation
(i.e., bits), <span class="math notranslate nohighlight">\(9 = ...01001\)</span> (the vector entries) and
<span class="math notranslate nohighlight">\(5 = ...00101\)</span> (the initial reduction value).
So <span class="math notranslate nohighlight">\(9 | 5 = ...01001 | ...00101 = ...01101 = 13\)</span>.</p>
</section>
<section id="reduction-policies">
<h2>Reduction Policies<a class="headerlink" href="#reduction-policies" title="Permalink to this headline">¶</a></h2>
<p>For more information about available RAJA reduction policies and guidance
on which to use with RAJA execution policies, please see
<a class="reference internal" href="policies.html#reducepolicy-label"><span class="std std-ref">Reduction Policies</span></a>.</p>
</section>
<section id="experimental-reduction-interface">
<h2>Experimental Reduction Interface<a class="headerlink" href="#experimental-reduction-interface" title="Permalink to this headline">¶</a></h2>
<p>An experimental reduction interface is now available that offers serveral usability and performance advantages over
upon the current reduction model in RAJA. The new interface allows <code class="docutils literal notranslate"><span class="pre">RAJA::forall</span></code>
to take optional “plugin-like” objects to extend the execution behaviour
of a <code class="docutils literal notranslate"><span class="pre">RAJA::forall</span></code> execution context.</p>
<p>The new interface passes <code class="docutils literal notranslate"><span class="pre">RAJA::expt::Reduce&lt;OP_TYPE&gt;</span></code> objects as function arguments
to <code class="docutils literal notranslate"><span class="pre">RAJA::forall</span></code> and provides users with thread-local variables
of the reduction data type to be updated inside the lambda. This differs
from the current reduction model in which <code class="docutils literal notranslate"><span class="pre">RAJA::ReduceOP&lt;REDUCE_POL,</span> <span class="pre">T&gt;</span></code>
objects are captured by the user-supplied kernel body lambda expression.</p>
<section id="raja-expt-reduce">
<h3>RAJA::expt::Reduce<a class="headerlink" href="#raja-expt-reduce" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">double</span><span class="o">*</span> <span class="n">a</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>

<span class="n">double</span> <span class="n">rs</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">double</span> <span class="n">rm</span> <span class="o">=</span> <span class="mf">1e100</span><span class="p">;</span>

<span class="n">RAJA</span><span class="p">::</span><span class="n">forall</span><span class="o">&lt;</span><span class="n">EXEC_POL</span><span class="o">&gt;</span> <span class="p">(</span> <span class="n">Res</span><span class="p">,</span> <span class="n">Seg</span><span class="p">,</span>
<span class="n">RAJA</span><span class="p">::</span><span class="n">expt</span><span class="p">::</span><span class="n">Reduce</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="p">::</span><span class="n">operators</span><span class="p">::</span><span class="n">plus</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rs</span><span class="p">),</span>
<span class="n">RAJA</span><span class="p">::</span><span class="n">expt</span><span class="p">::</span><span class="n">Reduce</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="p">::</span><span class="n">operators</span><span class="p">::</span><span class="n">minimum</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rm</span><span class="p">),</span>
<span class="p">[</span><span class="o">=</span><span class="p">]</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">double</span><span class="o">&amp;</span> <span class="n">_rs</span><span class="p">,</span> <span class="n">double</span><span class="o">&amp;</span> <span class="n">_rm</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">_rs</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
  <span class="n">_rm</span> <span class="o">=</span> <span class="n">RAJA_MIN</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_rm</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">);</span>

<span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">rs</span> <span class="o">...</span>
<span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">rm</span> <span class="o">...</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RAJA::expt::Reduce</span></code> takes a target variable to write the final result to
(<code class="docutils literal notranslate"><span class="pre">rs</span></code>, <code class="docutils literal notranslate"><span class="pre">rm</span></code>). The reduction operation will include the initial value of
the given target variable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RAJA::forall</span></code> requires a corresponding lambda argument to
<code class="docutils literal notranslate"><span class="pre">RAJA::expt::Reduce</span></code> be passed (<code class="docutils literal notranslate"><span class="pre">_rs</span></code>, <code class="docutils literal notranslate"><span class="pre">_rm</span></code>). These arguments can be
used as the local instance of the target for the reduction operation.</p></li>
<li><p>The local variables (<code class="docutils literal notranslate"><span class="pre">_rs,</span> <span class="pre">``_rm</span></code>) are initialized with the “identity” of
the reduction operation to be performed.</p></li>
<li><p>A reduction is performed implicitly by the <code class="docutils literal notranslate"><span class="pre">RAJA::forall</span></code> across thread
copies of the local variables.</p></li>
<li><p>Finally, the reduction operation is performed against the original value of
the target and the result of the <code class="docutils literal notranslate"><span class="pre">RAJA::forall</span></code> reduction.</p></li>
<li><p>The final reduction value is accessed by referencing the target variable passed to <code class="docutils literal notranslate"><span class="pre">RAJA::expt::Reduce</span></code> in the <code class="docutils literal notranslate"><span class="pre">RAJA::forall</span></code> method.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the above example <code class="docutils literal notranslate"><span class="pre">Res</span></code> is a resource object that must be
compatible with the <code class="docutils literal notranslate"><span class="pre">EXEC_POL</span></code>. <code class="docutils literal notranslate"><span class="pre">Seg</span></code> is the iteration space
object for <code class="docutils literal notranslate"><span class="pre">RAJA::forall</span></code>.</p>
</div>
</section>
<section id="raja-expt-valloc">
<h3>RAJA::expt::ValLoc<a class="headerlink" href="#raja-expt-valloc" title="Permalink to this headline">¶</a></h3>
<p>RAJA supports <code class="docutils literal notranslate"><span class="pre">Loc</span></code> reductions, which provide the ability to get a kernel/loop index at which the final reduction value was found. With this new interface, <code class="docutils literal notranslate"><span class="pre">Loc</span></code> reductions
can be performed using <code class="docutils literal notranslate"><span class="pre">ValLoc&lt;T&gt;</span></code> types. Since they are strongly typed they
provide <code class="docutils literal notranslate"><span class="pre">min()</span></code> and <code class="docutils literal notranslate"><span class="pre">max()</span></code> operations. Users must use <code class="docutils literal notranslate"><span class="pre">getVal()</span></code> and <code class="docutils literal notranslate"><span class="pre">getLoc()</span></code> methods to
access the reduction results.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">double</span><span class="o">*</span> <span class="n">a</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>

<span class="n">using</span> <span class="n">VL_DOUBLE</span> <span class="o">=</span> <span class="n">RAJA</span><span class="p">::</span><span class="n">expt</span><span class="p">::</span><span class="n">ValLoc</span><span class="o">&lt;</span><span class="n">double</span><span class="o">&gt;</span><span class="p">;</span>
<span class="n">VL_DOUBLE</span> <span class="n">rm_loc</span><span class="p">;</span>

<span class="n">RAJA</span><span class="p">::</span><span class="n">forall</span><span class="o">&lt;</span><span class="n">EXEC_POL</span><span class="o">&gt;</span> <span class="p">(</span> <span class="n">Res</span><span class="p">,</span> <span class="n">Seg</span><span class="p">,</span>
<span class="n">RAJA</span><span class="p">::</span><span class="n">expt</span><span class="p">::</span><span class="n">Reduce</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="p">::</span><span class="n">operators</span><span class="p">::</span><span class="n">minimum</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rm_loc</span><span class="p">),</span>
<span class="p">[</span><span class="o">=</span><span class="p">]</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">VL_DOUBLE</span><span class="o">&amp;</span> <span class="n">_rm_loc</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">_rm_loc</span> <span class="o">=</span> <span class="n">RAJA_MIN</span><span class="p">(</span><span class="n">VL_DOUBLE</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">),</span> <span class="n">_rm_loc</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">);</span>

<span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">rm_loc</span><span class="o">.</span><span class="n">getVal</span><span class="p">()</span> <span class="o">...</span>
<span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">rm_loc</span><span class="o">.</span><span class="n">getLoc</span><span class="p">()</span> <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="lambda-arguments">
<h3>Lambda Arguments<a class="headerlink" href="#lambda-arguments" title="Permalink to this headline">¶</a></h3>
<p>This interface takes advantage of C++ parameter packs to allow users to pass
any number of <code class="docutils literal notranslate"><span class="pre">RAJA::expt::Reduce</span></code> objects to their RAJA::forall calls.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">double</span><span class="o">*</span> <span class="n">a</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>

<span class="n">using</span> <span class="n">VL_DOUBLE</span> <span class="o">=</span> <span class="n">RAJA</span><span class="p">::</span><span class="n">expt</span><span class="p">::</span><span class="n">ValLoc</span><span class="o">&lt;</span><span class="n">double</span><span class="o">&gt;</span><span class="p">;</span>
<span class="n">VL_DOUBLE</span> <span class="n">rm_loc</span><span class="p">;</span>
<span class="n">double</span> <span class="n">rs</span><span class="p">;</span>
<span class="n">double</span> <span class="n">rm</span><span class="p">;</span>

<span class="n">RAJA</span><span class="p">::</span><span class="n">forall</span><span class="o">&lt;</span><span class="n">EXEC_POL</span><span class="o">&gt;</span> <span class="p">(</span> <span class="n">Res</span><span class="p">,</span> <span class="n">Seg</span><span class="p">,</span>
  <span class="n">RAJA</span><span class="p">::</span><span class="n">expt</span><span class="p">::</span><span class="n">Reduce</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="p">::</span><span class="n">operators</span><span class="p">::</span><span class="n">plus</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rs</span><span class="p">),</span>        <span class="o">//</span> <span class="o">--&gt;</span> <span class="mi">1</span> <span class="n">double</span> <span class="n">added</span>
  <span class="n">RAJA</span><span class="p">::</span><span class="n">expt</span><span class="p">::</span><span class="n">Reduce</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="p">::</span><span class="n">operators</span><span class="p">::</span><span class="n">minimum</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rm</span><span class="p">),</span>     <span class="o">//</span> <span class="o">--&gt;</span> <span class="mi">1</span> <span class="n">double</span> <span class="n">added</span>
  <span class="n">RAJA</span><span class="p">::</span><span class="n">expt</span><span class="p">::</span><span class="n">Reduce</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="p">::</span><span class="n">operators</span><span class="p">::</span><span class="n">minimum</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rm_loc</span><span class="p">),</span> <span class="o">//</span> <span class="o">--&gt;</span> <span class="mi">1</span> <span class="n">VL_DOUBLE</span> <span class="n">added</span>
  <span class="n">RAJA</span><span class="p">::</span><span class="n">expt</span><span class="p">::</span><span class="n">KernelName</span><span class="p">(</span><span class="s2">&quot;MyFirstRAJAKernel&quot;</span><span class="p">),</span>           <span class="o">//</span> <span class="o">--&gt;</span> <span class="n">NO</span> <span class="n">args</span> <span class="n">added</span>
  <span class="p">[</span><span class="o">=</span><span class="p">]</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">double</span><span class="o">&amp;</span> <span class="n">_rs</span><span class="p">,</span> <span class="n">double</span><span class="o">&amp;</span> <span class="n">_rm</span><span class="p">,</span> <span class="n">VL_DOUBLE</span><span class="o">&amp;</span> <span class="n">_rm_loc</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">_rs</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">_rm</span> <span class="o">=</span> <span class="n">RAJA_MIN</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_rm</span><span class="p">);</span>
    <span class="n">_rm_loc</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">VL_DOUBLE</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">rs</span> <span class="o">...</span>
<span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">rm</span> <span class="o">...</span>
<span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">rm_loc</span><span class="o">.</span><span class="n">getVal</span><span class="p">()</span> <span class="o">...</span>
<span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">rm_loc</span><span class="o">.</span><span class="n">getLoc</span><span class="p">()</span> <span class="o">...</span>
</pre></div>
</div>
<p>The lambda arguments are passed in the same respective order to that of the
ForallParams. Both the types and number of arguments are required to be correct
in order to compile successfully otherwise a static assertion will be triggered:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LAMBDA</span> <span class="n">Not</span> <span class="n">invocable</span> <span class="n">w</span><span class="o">/</span> <span class="n">EXPECTED_ARGS</span><span class="o">.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This static assert is only enabled when passing a generic lambda,
this check will not happed when passing extended-lambdas (i.e. DEVICE
tagged lambdas) or other functor like objects.</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="view.html" class="btn btn-neutral float-left" title="View and Layout" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="atomic.html" class="btn btn-neutral float-right" title="Atomic Operations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, Lawrence Livermore National Security, LLNS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>