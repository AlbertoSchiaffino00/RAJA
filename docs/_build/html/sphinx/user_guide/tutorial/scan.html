<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Parallel Scan Operations &mdash; RAJA 2022.03.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Parallel Sort Operations" href="sort.html" />
    <link rel="prev" title="Atomic Operations: Computing a Histogram" href="atomic_histogram.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> RAJA
            <img src="../../../_static/RAJA_LOGO_CMYK_White_Background_large.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.03
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">RAJA User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">Getting Started With RAJA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using_raja.html">Using RAJA in Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config_options.html">Build Configuration Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features.html">RAJA Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app_considerations.html">Application Considerations</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tutorial.html">RAJA Tutorial and Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#raja-tutorial">RAJA Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#a-little-c-background">A Little C++ Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#raja-examples-and-exercises">RAJA Examples and Exercises</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../tutorial.html#simple-loops-and-basic-raja-features">Simple Loops and Basic RAJA Features</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="add_vectors.html">Basic Loop Execution: Vector Addition</a></li>
<li class="toctree-l4"><a class="reference internal" href="indexset_segments.html">Iteration Spaces: Segments and IndexSets</a></li>
<li class="toctree-l4"><a class="reference internal" href="vertexsum_coloring.html">Iteration Space Coloring: Mesh Vertex Sum</a></li>
<li class="toctree-l4"><a class="reference internal" href="dot_product.html">Sum Reduction: Vector Dot Product</a></li>
<li class="toctree-l4"><a class="reference internal" href="reductions.html">Reduction Types and Kernels with Multiple Reductions</a></li>
<li class="toctree-l4"><a class="reference internal" href="atomic_histogram.html">Atomic Operations: Computing a Histogram</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Parallel Scan Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="sort.html">Parallel Sort Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="view_layout.html">Data Views and Layouts</a></li>
<li class="toctree-l4"><a class="reference internal" href="permuted-layout-batch-matrix-multiply.html">Permuted Layout: Batched Matrix-Multiplication</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#complex-loops-and-advanced-raja-features">Complex Loops and Advanced RAJA Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#nested-loops-with-raja-kernel">Nested Loops with <code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#nested-loops-with-raja-expt-launch">Nested Loops with <code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#comparing-raja-kernel-and-raja-expt-launch-matrix-transpose">Comparing <code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code> and <code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code>: Matrix-Transpose</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#other-raja-features-and-usage-examples">Other RAJA Features and Usage Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">RAJA Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../raja_license.html">RAJA Copyright and License Information</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">RAJA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">RAJA User Guide</a> &raquo;</li>
          <li><a href="../tutorial.html">RAJA Tutorial and Examples</a> &raquo;</li>
      <li>Parallel Scan Operations</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/sphinx/user_guide/tutorial/scan.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="parallel-scan-operations">
<span id="tut-scan-label"></span><h1>Parallel Scan Operations<a class="headerlink" href="#parallel-scan-operations" title="Permalink to this headline">Â¶</a></h1>
<p>This section contains an exercise file <code class="docutils literal notranslate"><span class="pre">RAJA/exercises/scan.cpp</span></code>
for you to work through if you wish to get some practice with RAJA. The
file <code class="docutils literal notranslate"><span class="pre">RAJA/exercises/scan_solution.cpp</span></code> contains complete
working code for the examples discussed in this section. You can use the
solution file to check your work and for guidance if you get stuck. To build
the exercises execute <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">scan</span></code> and <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">scan_solution</span></code>
from the build directory.</p>
<p>Key RAJA features shown in this section are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RAJA::inclusive_scan</span></code>, <code class="docutils literal notranslate"><span class="pre">RAJA::inclusive_scan_inplace</span></code>,
<code class="docutils literal notranslate"><span class="pre">RAJA::exclusive_scan</span></code>, and <code class="docutils literal notranslate"><span class="pre">RAJA::exclusive_scan_inplace</span></code> operations
and execution policies</p></li>
<li><p>RAJA operators for different types of scans; e.g., plus, minimum, maximum,
etc.</p></li>
</ul>
</div></blockquote>
<p>In this section, we present examples of various RAJA scan operations using
multiple RAJA execution back-ends. Different scan operations can be
performed by passing different RAJA operators to the RAJA scan template
methods. Each operator is a template type, where the template argument is
the type of the values it operates on. For a summary of RAJA scan
functionality, please see <a class="reference internal" href="../feature/scan.html#feat-scan-label"><span class="std std-ref">Scan Operations</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>RAJA scan operations use the same execution policy types that
<code class="docutils literal notranslate"><span class="pre">RAJA::forall</span></code> kernel execution templates do.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>RAJA scan operations take âspanâ arguments to express the sequential
index range of array entries used in the scan. Typically, these
span objects are created using the <code class="docutils literal notranslate"><span class="pre">RAJA::make_span</span></code> method
as shown in the examples below.</p>
</div>
<p>Each of the examples below uses the same integer arrays for input
and output values. We initialize the input array and print its values as such:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span>
<span class="c1">// Define array length</span>
<span class="c1">//</span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w"></span>

<span class="c1">//</span>
<span class="c1">// Allocate and initialize vector data</span>
<span class="c1">//</span>
<span class="w">  </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">memoryManager</span><span class="o">::</span><span class="n">allocate</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">N</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">memoryManager</span><span class="o">::</span><span class="n">allocate</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">N</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">iota</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> in values...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">printArray</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>This generates the following sequence of values. This sequence will be used as
the âinâ array for each of the following examples.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="mi">13</span> <span class="mi">14</span> <span class="mi">15</span> <span class="mi">16</span> <span class="mi">17</span> <span class="mi">18</span>
</pre></div>
</div>
<section id="inclusive-scans">
<h2>Inclusive Scans<a class="headerlink" href="#inclusive-scans" title="Permalink to this headline">Â¶</a></h2>
<p>RAJAâs scan operations are standalone operations. That is, they cannot be
combined with other operations in a kernel. A sequential
inclusive scan operation can be executed like so:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">inclusive_scan</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">seq_exec</span><span class="o">&gt;</span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_span</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"></span>
<span class="w">                                       </span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_span</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
<p>Since no operator is passed to the scan method, the default âplusâ operation
is applied and the result generated in the âoutâ array is a prefix-sum based
on the âinâ array. The resulting âoutâ array contains the values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">5</span> <span class="mi">9</span> <span class="mi">14</span> <span class="mi">20</span> <span class="mi">27</span> <span class="mi">35</span> <span class="mi">44</span> <span class="mi">54</span> <span class="mi">65</span> <span class="mi">77</span> <span class="mi">90</span> <span class="mi">104</span> <span class="mi">119</span> <span class="mi">135</span> <span class="mi">152</span> <span class="mi">170</span>
</pre></div>
</div>
<p>In particular, each entry in the output array is a <em>partial sum</em> of all
input array entries up to that array index.</p>
<p>We can be explicit about the operation used in the scan by passing the RAJA
âplusâ operator <code class="docutils literal notranslate"><span class="pre">RAJA::operators::plus&lt;int&gt;</span></code> to the scan method:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">inclusive_scan</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">seq_exec</span><span class="o">&gt;</span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_span</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"></span>
<span class="w">                                       </span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_span</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"></span>
<span class="w">                                       </span><span class="n">RAJA</span><span class="o">::</span><span class="n">operators</span><span class="o">::</span><span class="n">plus</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{});</span><span class="w"></span>
</pre></div>
</div>
<p>The result in the âoutâ array is the same as above.</p>
<p>An inclusive parallel scan operation using OpenMP multithreading is
accomplished similarly by replacing the execution policy type:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">inclusive_scan</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">omp_parallel_for_exec</span><span class="o">&gt;</span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_span</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"></span>
<span class="w">                                                    </span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_span</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"></span>
<span class="w">                                                    </span><span class="n">RAJA</span><span class="o">::</span><span class="n">operators</span><span class="o">::</span><span class="n">plus</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{});</span><span class="w"></span>
</pre></div>
</div>
<p>As expected, this produces the same result as the previous two examples.</p>
<p>As is commonly the case with RAJA, the only difference between this code and
the previous one is the execution policy. If we want to
run the scan on a GPU using CUDA, we would use a CUDA execution policy as
is shown in examples below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If no operator is passed to a RAJA scan operation, the default
plus operator is used, resulting in a prefix-sum.</p>
</div>
</section>
<section id="exclusive-scans">
<h2>Exclusive Scans<a class="headerlink" href="#exclusive-scans" title="Permalink to this headline">Â¶</a></h2>
<p>A sequential exclusive scan (plus) operation is performed by:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">exclusive_scan</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">seq_exec</span><span class="o">&gt;</span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_span</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"></span>
<span class="w">                                       </span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_span</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"></span>
<span class="w">                                       </span><span class="n">RAJA</span><span class="o">::</span><span class="n">operators</span><span class="o">::</span><span class="n">plus</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{});</span><span class="w"></span>
</pre></div>
</div>
<p>This generates the following sequence of values in the output array:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">5</span> <span class="mi">9</span> <span class="mi">14</span> <span class="mi">20</span> <span class="mi">27</span> <span class="mi">35</span> <span class="mi">44</span> <span class="mi">54</span> <span class="mi">65</span> <span class="mi">77</span> <span class="mi">90</span> <span class="mi">104</span> <span class="mi">119</span> <span class="mi">135</span> <span class="mi">152</span>
</pre></div>
</div>
<p>The result of an exclusive scan is similar to the result of an
inclusive scan, but differs in two ways. First, the first entry in
the exclusive scan output array is the <cite>identity</cite> of the operator used.
In the example here, it is zero, since the operator is âplusâ.
Second, the output sequence is shifted one position to the right
when compared to an inclusive scan.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <cite>identity</cite> of an operator is the default value of a given type
for that operation. For example:
- The identity of an int for a sum operation is 0.
- The identity of an int for a maximum operation is -2147483648.</p>
</div>
<p>Running the same scan operation on a GPU using CUDA is done by:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">exclusive_scan</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">cuda_exec</span><span class="o">&lt;</span><span class="n">CUDA_BLOCK_SIZE</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_span</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"></span>
<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_span</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"></span>
<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">operators</span><span class="o">::</span><span class="n">plus</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{});</span><span class="w"></span>
</pre></div>
</div>
<p>Note that we pass the number of threads per CUDA thread block as the template
argument to the CUDA execution policy as we do when using <code class="docutils literal notranslate"><span class="pre">RAJA::forall</span></code>.</p>
</section>
<section id="in-place-scans-and-other-operators">
<h2>In-place Scans and Other Operators<a class="headerlink" href="#in-place-scans-and-other-operators" title="Permalink to this headline">Â¶</a></h2>
<p><em>In-place</em> scan variants generate the same results as the scan operations
we have just described. However, the result is generated in the input array
directly so <strong>only one array is passed to in-place scan methods.</strong></p>
<p>Here is a sequential inclusive in-place scan that uses the âminimumâ operator:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">copy_n</span><span class="p">(</span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">inclusive_scan_inplace</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">seq_exec</span><span class="o">&gt;</span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_span</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"></span>
<span class="w">                                               </span><span class="n">RAJA</span><span class="o">::</span><span class="n">operators</span><span class="o">::</span><span class="n">minimum</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{});</span><span class="w"></span>
</pre></div>
</div>
<p>Note that, before the scan operation is invoked, we copy the
input array into the output array to provide the scan input array we want.</p>
<p>This generates the following sequence in the output array:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>Since the operator used in the scan is âminimumâ and the smallest values in
the input array is the first entry, the result is an array with that value
in all array slots.</p>
<p>Here is a sequential exclusive in-place scan that uses the âmaximumâ operator:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">exclusive_scan_inplace</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">seq_exec</span><span class="o">&gt;</span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_span</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"></span>
<span class="w">                                               </span><span class="n">RAJA</span><span class="o">::</span><span class="n">operators</span><span class="o">::</span><span class="n">maximum</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{});</span><span class="w"></span>
</pre></div>
</div>
<p>This generates the following sequence in the output array:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="mi">2147483648</span> <span class="o">-</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="mi">13</span> <span class="mi">14</span> <span class="mi">15</span> <span class="mi">16</span> <span class="mi">17</span>
</pre></div>
</div>
<p>Since it is an exclusive scan, the first value in the result is the negative
of the max int value, which is the identity of the âmaximumâ operator.</p>
<p>As you may expect at this point, running an exclusive in-place prefix-sum
operation using OpenMP is accomplished by:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">exclusive_scan_inplace</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">omp_parallel_for_exec</span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_span</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"></span>
<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">operators</span><span class="o">::</span><span class="n">plus</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{});</span><span class="w"></span>
</pre></div>
</div>
<p>This generates the following sequence in the output array (as we saw earlier):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="mi">1</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">5</span> <span class="mi">9</span> <span class="mi">14</span> <span class="mi">20</span> <span class="mi">27</span> <span class="mi">35</span> <span class="mi">44</span> <span class="mi">54</span> <span class="mi">65</span> <span class="mi">77</span> <span class="mi">90</span> <span class="mi">104</span> <span class="mi">119</span> <span class="mi">135</span> <span class="mi">152</span>
</pre></div>
</div>
<p>and the only difference is the execution policy template parameter.</p>
<p>Lastly, we show a parallel inclusive in-place prefix-sum operation using CUDA:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">inclusive_scan_inplace</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">cuda_exec</span><span class="o">&lt;</span><span class="n">CUDA_BLOCK_SIZE</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_span</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"></span>
<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">operators</span><span class="o">::</span><span class="n">plus</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{});</span><span class="w"></span>
</pre></div>
</div>
<p>and the same using the RAJA HIP back-end:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">inclusive_scan_inplace</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">hip_exec</span><span class="o">&lt;</span><span class="n">HIP_BLOCK_SIZE</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_span</span><span class="p">(</span><span class="n">d_out</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"></span>
<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">operators</span><span class="o">::</span><span class="n">plus</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{});</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="atomic_histogram.html" class="btn btn-neutral float-left" title="Atomic Operations: Computing a Histogram" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="sort.html" class="btn btn-neutral float-right" title="Parallel Sort Operations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, Lawrence Livermore National Security, LLNS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>