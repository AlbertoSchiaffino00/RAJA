<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tiled Matrix Transpose &mdash; RAJA 2022.03.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Tiled Matrix Transpose with Local Array" href="matrix_transpose_local_array.html" />
    <link rel="prev" title="Matrix Transpose" href="matrix_transpose.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> RAJA
            <img src="../../../_static/RAJA_LOGO_CMYK_White_Background_large.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2022.03
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">RAJA User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting_started.html">Getting Started With RAJA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using_raja.html">Using RAJA in Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config_options.html">Build Configuration Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features.html">RAJA Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../app_considerations.html">Application Considerations</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../tutorial.html">RAJA Tutorial and Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#raja-tutorial">RAJA Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#a-little-c-background">A Little C++ Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#raja-examples-and-exercises">RAJA Examples and Exercises</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#simple-loops-and-basic-raja-features">Simple Loops and Basic RAJA Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#complex-loops-and-advanced-raja-features">Complex Loops and Advanced RAJA Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#nested-loops-with-raja-kernel">Nested Loops with <code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#nested-loops-with-raja-expt-launch">Nested Loops with <code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code></a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../tutorial.html#comparing-raja-kernel-and-raja-expt-launch-matrix-transpose">Comparing <code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code> and <code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code>: Matrix-Transpose</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="matrix_transpose.html">Matrix Transpose</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Tiled Matrix Transpose</a></li>
<li class="toctree-l4"><a class="reference internal" href="matrix_transpose_local_array.html">Tiled Matrix Transpose with Local Array</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial.html#other-raja-features-and-usage-examples">Other RAJA Features and Usage Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">RAJA Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../raja_license.html">RAJA Copyright and License Information</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">RAJA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">RAJA User Guide</a> &raquo;</li>
          <li><a href="../tutorial.html">RAJA Tutorial and Examples</a> &raquo;</li>
      <li>Tiled Matrix Transpose</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/sphinx/user_guide/tutorial/matrix_transpose_tiled.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tiled-matrix-transpose">
<span id="tut-tiledmatrixtranspose-label"></span><h1>Tiled Matrix Transpose<a class="headerlink" href="#tiled-matrix-transpose" title="Permalink to this headline">Â¶</a></h1>
<p>This section describes the implementation of a tiled matrix transpose kernel
using both <code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code> and <code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code> interfaces. The intent
is to compare and contrast the two. The discussion builds on
<a class="reference internal" href="matrix_transpose.html#tut-matrixtranspose-label"><span class="std std-ref">Matrix Transpose</span></a> by adding tiling to the matrix transpose
implementation.</p>
<p>There are exercise files
<code class="docutils literal notranslate"><span class="pre">RAJA/exercises/kernel-matrix-transpose-tiled.cpp</span></code> and
<code class="docutils literal notranslate"><span class="pre">RAJA/exercises/launch-matrix-transpose-tiled.cpp</span></code> for you to work through
if you wish to get some practice with RAJA. The files
<code class="docutils literal notranslate"><span class="pre">RAJA/exercises/kernel-matrix-transpose-tiled_solution.cpp</span></code> and
<code class="docutils literal notranslate"><span class="pre">RAJA/exercises/launch-matrix-transpose-tiled_solution.cpp</span></code> contain
complete working code for the examples. You can use the solution files to
check your work and for guidance if you get stuck. To build
the exercises execute <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">(kernel/launch)-matrix-transpose-tiled</span></code> and
<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">(kernel/launch)-matrix-transpose-tiled_solution</span></code>
from the build directory.</p>
<p>Key RAJA features shown in this example are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code> method and execution policies, and the <code class="docutils literal notranslate"><span class="pre">RAJA::statement::Tile</span></code> type</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code> method and execution policies, and the <code class="docutils literal notranslate"><span class="pre">RAJA::expt::tile</span></code> type</p></li>
</ul>
</div></blockquote>
<p>As in <a class="reference internal" href="matrix_transpose.html#tut-matrixtranspose-label"><span class="std std-ref">Matrix Transpose</span></a>, we compute the transpose of an input
matrix <span class="math notranslate nohighlight">\(A\)</span> of size <span class="math notranslate nohighlight">\(N_r \times N_c\)</span> and storing the result in a
second matrix <span class="math notranslate nohighlight">\(At\)</span> of size <span class="math notranslate nohighlight">\(N_c \times N_r\)</span>.</p>
<p>We will compute the matrix transpose using a tiling algorithm, which iterates
over tiles and transposes the matrix entries in each tile.
The algorithm involves outer and inner loops to iterate over the tiles and
matrix entries within each tile, respectively.</p>
<p>As in <a class="reference internal" href="matrix_transpose.html#tut-matrixtranspose-label"><span class="std std-ref">Matrix Transpose</span></a>, we start by defining the matrix
dimensions. Additionally, we define a tile size smaller than the matrix
dimensions and determine the number of tiles in each dimension. Note that we
do not assume that tiles divide evenly the number of rows and and columns of
the matrix. However, we do assume square tiles.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">56</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">75</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">TILE_DIM</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">outer_Dimc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N_c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TILE_DIM</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">outer_Dimr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N_r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">TILE_DIM</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Then, we wrap the matrix data pointers in <code class="docutils literal notranslate"><span class="pre">RAJA::View</span></code> objects to
simplify the multi-dimensional indexing:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">Layout</span><span class="o">&lt;</span><span class="n">DIM</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">Aview</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">N_r</span><span class="p">,</span><span class="w"> </span><span class="n">N_c</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">View</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">Layout</span><span class="o">&lt;</span><span class="n">DIM</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">Atview</span><span class="p">(</span><span class="n">At</span><span class="p">,</span><span class="w"> </span><span class="n">N_c</span><span class="p">,</span><span class="w"> </span><span class="n">N_r</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The C-style for-loop implementation looks like this:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="c1">// (0) Outer loops to iterate over tiles</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">outer_Dimr</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">by</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">bx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">bx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">outer_Dimc</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">bx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="c1">// (1) Loops to iterate over tile entries</span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ty</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">TILE_DIM</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">ty</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">tx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">tx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">TILE_DIM</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">tx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">          </span><span class="kt">int</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">TILE_DIM</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tx</span><span class="p">;</span><span class="w">  </span><span class="c1">// Matrix column index</span>
<span class="w">          </span><span class="kt">int</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">TILE_DIM</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ty</span><span class="p">;</span><span class="w">  </span><span class="c1">// Matrix row index</span>

<span class="w">          </span><span class="c1">// Bounds check</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">row</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N_r</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N_c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">Atview</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">row</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Aview</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To prevent indexing out of bounds, when the tile dimensions do not
divide evenly the matrix dimensions, the algorithm requires a
bounds check in the inner loops.</p>
</div>
<section id="raja-kernel-variants">
<h2><code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code> Variants<a class="headerlink" href="#raja-kernel-variants" title="Permalink to this headline">Â¶</a></h2>
<p>For <code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code> variants, we use <code class="docutils literal notranslate"><span class="pre">RAJA::statement::Tile</span></code> types
for the outer loop tiling and <code class="docutils literal notranslate"><span class="pre">RAJA::tile_fixed</span></code> types to
indicate the tile dimensions. The complete sequential RAJA variant is:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">TILED_KERNEL_EXEC_POL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">    </span><span class="n">RAJA</span><span class="o">::</span><span class="n">KernelPolicy</span><span class="o">&lt;</span><span class="w"></span>
<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">statement</span><span class="o">::</span><span class="n">Tile</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">tile_fixed</span><span class="o">&lt;</span><span class="n">TILE_DIM</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">loop_exec</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">RAJA</span><span class="o">::</span><span class="n">statement</span><span class="o">::</span><span class="n">Tile</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">tile_fixed</span><span class="o">&lt;</span><span class="n">TILE_DIM</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">loop_exec</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="n">RAJA</span><span class="o">::</span><span class="n">statement</span><span class="o">::</span><span class="n">For</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">loop_exec</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">RAJA</span><span class="o">::</span><span class="n">statement</span><span class="o">::</span><span class="n">For</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">loop_exec</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="n">RAJA</span><span class="o">::</span><span class="n">statement</span><span class="o">::</span><span class="n">Lambda</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">            </span><span class="o">&gt;</span><span class="w"></span>
<span class="w">          </span><span class="o">&gt;</span><span class="w"></span>
<span class="w">        </span><span class="o">&gt;</span><span class="w"></span>
<span class="w">      </span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">kernel</span><span class="o">&lt;</span><span class="n">TILED_KERNEL_EXEC_POL</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">col_Range</span><span class="p">,</span><span class="w"> </span><span class="n">row_Range</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="o">=</span><span class="p">](</span><span class="kt">int</span><span class="w"> </span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">row</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">Atview</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">row</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Aview</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">RAJA::statement::Tile</span></code> types compute the number of tiles needed to
iterate over all matrix entries in each dimension and generate iteration
index bounds for each tile, which are used to generate loops for the inner
<code class="docutils literal notranslate"><span class="pre">RAJA::statement::For</span></code> types. Thus, the explicit bounds checking logic in the
C-style variant is not needed. Note that the integer template parameters
in the <code class="docutils literal notranslate"><span class="pre">RAJA::statement::For</span></code> types refer to the entries in the iteration
space tuple passed to the <code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code> method.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code> CUDA variant is similar with sequential policies replaced
with CUDA execution policies:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">TILED_KERNEL_EXEC_POL_CUDA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">    </span><span class="n">RAJA</span><span class="o">::</span><span class="n">KernelPolicy</span><span class="o">&lt;</span><span class="w"></span>
<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">statement</span><span class="o">::</span><span class="n">CudaKernel</span><span class="o">&lt;</span><span class="w"></span>
<span class="w">        </span><span class="n">RAJA</span><span class="o">::</span><span class="n">statement</span><span class="o">::</span><span class="n">Tile</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">tile_fixed</span><span class="o">&lt;</span><span class="n">TILE_DIM</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">cuda_block_y_loop</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="n">RAJA</span><span class="o">::</span><span class="n">statement</span><span class="o">::</span><span class="n">Tile</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">tile_fixed</span><span class="o">&lt;</span><span class="n">TILE_DIM</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">cuda_block_x_loop</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">RAJA</span><span class="o">::</span><span class="n">statement</span><span class="o">::</span><span class="n">For</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">cuda_thread_x_direct</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="n">RAJA</span><span class="o">::</span><span class="n">statement</span><span class="o">::</span><span class="n">For</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">cuda_thread_y_direct</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">RAJA</span><span class="o">::</span><span class="n">statement</span><span class="o">::</span><span class="n">Lambda</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"> </span>
<span class="w">              </span><span class="o">&gt;</span><span class="w"></span>
<span class="w">            </span><span class="o">&gt;</span><span class="w"></span>
<span class="w">          </span><span class="o">&gt;</span><span class="w"></span>
<span class="w">        </span><span class="o">&gt;</span><span class="w"></span>
<span class="w">      </span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">kernel</span><span class="o">&lt;</span><span class="n">TILED_KERNEL_EXEC_POL_CUDA</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">col_Range</span><span class="p">,</span><span class="w"> </span><span class="n">row_Range</span><span class="p">),</span><span class="w"> </span>
<span class="w">    </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="n">RAJA_DEVICE</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">row</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">Atview</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">row</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Aview</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>A notable difference between the CPU and GPU execution policy is the insertion
of the <code class="docutils literal notranslate"><span class="pre">RAJA::statement::CudaKernel</span></code> type in the GPU version, which indicates
that the execution will launch a CUDA device kernel.</p>
<p>The CUDA thread-block dimensions are set based on the tile dimensions and the
iterates withing each tile are mapped directly to GPU threads in each block
due to the <code class="docutils literal notranslate"><span class="pre">RAJA::cuda_thread_{x,</span> <span class="pre">y}_direct</span></code> policies.</p>
</section>
<section id="raja-expt-launch-variants">
<h2><code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code> Variants<a class="headerlink" href="#raja-expt-launch-variants" title="Permalink to this headline">Â¶</a></h2>
<p>For <code class="docutils literal notranslate"><span class="pre">RAJA::exp::launch</span></code> variants, we use <code class="docutils literal notranslate"><span class="pre">RAJA::expt::tile</span></code> methods
for the outer loop tiling and <code class="docutils literal notranslate"><span class="pre">RAJA::expt::loop</span></code> methods
to iterate within the tiles. The complete sequential tiled
<code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code> variant is:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">loop_pol_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">loop_exec</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">launch_policy_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LaunchPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">seq_launch_t</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">launch</span><span class="o">&lt;</span><span class="n">launch_policy_1</span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Grid</span><span class="p">(),</span><span class="w"> </span><span class="c1">//Grid may be empty when running on the cpu</span>
<span class="w">    </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="n">RAJA_HOST_DEVICE</span><span class="w"> </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LaunchContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">tile</span><span class="o">&lt;</span><span class="n">loop_pol_1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">TILE_DIM</span><span class="p">,</span><span class="w"> </span><span class="n">row_Range</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">row_tile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">tile</span><span class="o">&lt;</span><span class="n">loop_pol_1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">TILE_DIM</span><span class="p">,</span><span class="w"> </span><span class="n">col_Range</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">col_tile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">          </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">loop_pol_1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">row_tile</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">row</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">loop_pol_1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">col_tile</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">col</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">              </span><span class="n">Atview</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">row</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Aview</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="p">});</span><span class="w"></span>
<span class="w">          </span><span class="p">});</span><span class="w"></span>

<span class="w">        </span><span class="p">});</span><span class="w"></span>
<span class="w">      </span><span class="p">});</span><span class="w"></span>

<span class="w">  </span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>Similar to the <code class="docutils literal notranslate"><span class="pre">RAJA::statement::Tile</span></code> type in the <code class="docutils literal notranslate"><span class="pre">RAJA::kernel</span></code> variant
above, the <code class="docutils literal notranslate"><span class="pre">RAJA::expt::tile</span></code> method computes the number of tiles needed to
iterate over all matrix entries in each dimension and generates a corresponding
iteration space for each tile, which is used to generate loops for the inner
<code class="docutils literal notranslate"><span class="pre">RAJA::expt::loop</span></code> methods. Thus, the explicit bounds checking logic in the
C-style variant is not needed.</p>
<p>A CUDA <code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code> tiled variant for the GPU is similar with
different policies in the <code class="docutils literal notranslate"><span class="pre">RAJA::expt::loop</span></code> methods. The complete
<code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code> variant is:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">cuda_teams_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">cuda_block_y_direct</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">cuda_teams_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">cuda_block_x_direct</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">cuda_threads_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">cuda_thread_y_direct</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">cuda_threads_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LoopPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">cuda_thread_x_direct</span><span class="o">&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">cuda_async</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">cuda_launch_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LaunchPolicy</span><span class="o">&lt;</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">cuda_launch_t</span><span class="o">&lt;</span><span class="n">cuda_async</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">launch</span><span class="o">&lt;</span><span class="n">cuda_launch_policy</span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Grid</span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Teams</span><span class="p">(</span><span class="n">n_blocks_c</span><span class="p">,</span><span class="w"> </span><span class="n">n_blocks_r</span><span class="p">),</span><span class="w"></span>
<span class="w">                     </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">Threads</span><span class="p">(</span><span class="n">c_block_sz</span><span class="p">,</span><span class="w"> </span><span class="n">r_block_sz</span><span class="p">)),</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="n">RAJA_HOST_DEVICE</span><span class="w"> </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">LaunchContext</span><span class="w"> </span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">tile</span><span class="o">&lt;</span><span class="n">cuda_teams_y</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">TILE_DIM</span><span class="p">,</span><span class="w"> </span><span class="n">row_Range</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">row_tile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">tile</span><span class="o">&lt;</span><span class="n">cuda_teams_x</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">TILE_DIM</span><span class="p">,</span><span class="w"> </span><span class="n">col_Range</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">RAJA</span><span class="o">::</span><span class="n">TypedRangeSegment</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">&amp;</span><span class="n">col_tile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">          </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">cuda_threads_y</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">row_tile</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">row</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">RAJA</span><span class="o">::</span><span class="n">expt</span><span class="o">::</span><span class="n">loop</span><span class="o">&lt;</span><span class="n">cuda_threads_x</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">col_tile</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">col</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">              </span><span class="n">Atview</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="w"> </span><span class="n">row</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Aview</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="p">});</span><span class="w"></span>
<span class="w">          </span><span class="p">});</span><span class="w"></span>

<span class="w">        </span><span class="p">});</span><span class="w"></span>
<span class="w">      </span><span class="p">});</span><span class="w"></span>

<span class="w">  </span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>A notable difference between the CPU and GPU <code class="docutils literal notranslate"><span class="pre">RAJA::expt::launch</span></code>
implementations is the definition of the compute grid. For the CPU
version, the argument list is empty for the <code class="docutils literal notranslate"><span class="pre">RAJA::expt::Grid</span></code> constructor.
For the CUDA GPU implementation, we define a âTeamâ of one two-dimensional
thread-block with 16 x 16 = 256 threads.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="matrix_transpose.html" class="btn btn-neutral float-left" title="Matrix Transpose" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="matrix_transpose_local_array.html" class="btn btn-neutral float-right" title="Tiled Matrix Transpose with Local Array" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, Lawrence Livermore National Security, LLNS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>